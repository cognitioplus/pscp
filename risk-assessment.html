<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Integrated Risk Assessment Workbench</title>
    
    <!-- Google Fonts: Montserrat Classic, Poppins, Roboto Condensed -->
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700&family=Poppins:wght@600&family=Roboto+Condensed:wght@400;700&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.js"></script>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.js"></script>

    <!-- Tailwind Config -->
    <script>
        (function() {
            if (typeof tailwind !== 'undefined') {
                tailwind.config = {
                    theme: {
                        extend: {
                            fontFamily: {
                                heading: ['Montserrat', 'sans-serif'],
                                ui: ['Poppins', 'sans-serif'],
                                data: ['Roboto Condensed', 'sans-serif'],
                                sans: ['Poppins', 'sans-serif']
                            },
                            colors: {
                                primary: '#0078ff',
                                secondary: '#00c6ff',
                                accent: '#d4af37',
                                neutralBg: '#f8f9fa',
                                panel: '#ffffff',
                                border: '#e0e6ed',
                                text: '#2d3748',
                                textLight: '#4a5568',
                                textMuted: '#718096'
                            }
                        }
                    }
                }
            }
        })();
    </script>

    <style>
        /* Base */
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f8f9fa;
            color: #2d3748;
            margin: 0;
            padding: 0;
        }

        /* Scrollbar (high-contrast, clean) */
        ::-webkit-scrollbar {
            width: 10px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f3f5;
        }
        ::-webkit-scrollbar-thumb {
            background: #cbd5e0;
            border-radius: 5px;
            border: 2px solid #f1f3f5;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #a0aec0;
        }

        /* Chart Container */
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 800px;
            height: 400px;
            max-height: 500px;
            margin-left: auto;
            margin-right: auto;
        }
        @media (max-width: 768px) {
            .chart-container {
                height: 300px;
            }
        }

        /* Interactive Card */
        .interactive-card {
            background-color: #ffffff;
            border: 1px solid #e0e6ed;
            border-radius: 12px;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
        }
        .interactive-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0, 120, 255, 0.15);
            border-color: #0078ff;
        }
        .interactive-card:focus-within {
            outline: 2px solid #0078ff;
            outline-offset: 2px;
        }

        /* Timeline Line (neutral) */
        .timeline-line::before {
            content: '';
            position: absolute;
            top: 0;
            bottom: 0;
            left: 50%;
            width: 2px;
            background-color: #cbd5e0;
            z-index: 0;
            transform: translateX(-50%);
        }

        /* Risk Tags – WCAG AA Compliant */
        .risk-high { 
            background-color: #fee2e2; 
            color: #b91c1c; 
            font-weight: 700; 
            padding: 4px 8px; 
            border-radius: 4px; 
            border: 1px solid #fecaca; 
        } 
        .risk-medium { 
            background-color: #ffedd5; 
            color: #c2410c; 
            font-weight: 700; 
            padding: 4px 8px; 
            border-radius: 4px; 
            border: 1px solid #fed7aa; 
        }
        .risk-low { 
            background-color: #d1fae5; 
            color: #065f46; 
            font-weight: 700; 
            padding: 4px 8px; 
            border-radius: 4px; 
            border: 1px solid #a7f3d0; 
        }
        .risk-vlow { 
            background-color: #e0e7ff; 
            color: #312e81; 
            font-weight: 700; 
            padding: 4px 8px; 
            border-radius: 4px; 
            border: 1px solid #c7d2fe; 
        }

        /* Form Controls */
        input[type="text"],
        textarea,
        select {
            border-radius: 6px;
            border: 1px solid #cbd5e0;
            padding: 0.5rem 0.75rem;
            font-size: 0.875rem;
            width: 100%;
            background-color: #ffffff;
            color: #2d3748;
            font-family: 'Roboto Condensed', sans-serif;
        }
        input[type="text"]:focus,
        textarea:focus,
        select:focus {
            outline: none;
            border-color: #0078ff;
            box-shadow: 0 0 0 2px rgba(0, 120, 255, 0.2);
        }

        /* Table */
        #risk-table tbody tr {
            background-color: #ffffff;
            border-bottom: 1px solid #edf2f7;
        }
        #risk-table tbody tr:hover {
            background-color: #f8fafc;
        }

        /* Typography */
        h1, h2, h3, h4 {
            font-family: 'Montserrat', sans-serif;
            font-weight: 700;
        }
        .font-ui {
            font-family: 'Poppins', sans-serif;
            font-weight: 600;
        }
        .font-data {
            font-family: 'Roboto Condensed', sans-serif;
        }

        /* Navigation */
        .nav-item {
            font-family: 'Poppins', sans-serif;
            font-weight: 600;
            color: #4a5568;
            border-left: 4px solid transparent;
        }
        .nav-item:hover,
        .nav-item.active {
            color: #0078ff;
            background-color: #f0f7ff;
            border-left-color: #0078ff;
        }

        /* Buttons */
        .btn-primary {
            background-color: #0078ff;
            color: white;
            font-family: 'Poppins', sans-serif;
            font-weight: 600;
        }
        .btn-primary:hover {
            background-color: #0066d6;
        }
        .btn-warning {
            background-color: #d4af37;
            color: white;
            font-family: 'Poppins', sans-serif;
            font-weight: 600;
        }
        .btn-warning:hover {
            background-color: #b8860b;
        }

        /* Layout */
        .content-section {
            opacity: 1;
            transition: opacity 0.3s ease-in-out;
        }
        .content-section.hidden {
            display: none;
            opacity: 0;
        }

        .backdrop-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.4);
            z-index: 30;
            transition: opacity 0.3s;
            opacity: 0;
            pointer-events: none;
        }
        .backdrop-overlay.active {
            opacity: 1;
            pointer-events: auto;
        }
    </style>
</head>
<body class="text-gray-700 antialiased h-screen flex overflow-hidden">

    <!-- Backdrop for Mobile -->
    <div id="backdrop" class="backdrop-overlay" onclick="toggleMobileMenu()"></div>

    <!-- Mobile Menu Button -->
    <button id="mobile-menu-btn" class="md:hidden fixed top-4 right-4 z-50 bg-white text-primary p-3 rounded-full shadow-lg border-2 border-primary/30 hover:bg-gray-50 transition-colors">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="4" x2="20" y1="12" y2="12"/>
            <line x1="4" x2="20" y1="6" y2="6"/>
            <line x1="4" x2="20" y1="18" y2="18"/>
        </svg>
    </button>

    <!-- Sidebar Navigation (Simplified – No Redundancy) -->
    <aside id="sidebar" class="bg-white text-gray-700 w-64 flex-shrink-0 flex flex-col transition-transform duration-300 transform -translate-x-full md:translate-x-0 fixed md:sticky top-0 h-full z-40 border-r border-border shadow-sm">
        <div class="p-6 border-b border-border bg-gray-50">
            <h1 class="text-xl font-ui tracking-wide text-primary">PSCP <span class="text-accent">RISK CMD</span></h1>
            <p class="text-xs text-textMuted mt-1 font-data">ISO 31000 Workbench</p>
        </div>
        
        <nav class="flex-1 overflow-y-auto py-4">
            <ul class="space-y-1 px-3">
                <li>
                    <button onclick="navTo('context')" class="nav-item w-full text-left px-4 py-3 rounded-lg">Context Establishment</button>
                </li>
                <li>
                    <button onclick="navTo('assessment')" class="nav-item w-full text-left px-4 py-3 rounded-lg" id="nav-assessment">Risk Assessment</button>
                </li>
                <li>
                    <button onclick="navTo('evaluation')" class="nav-item w-full text-left px-4 py-3 rounded-lg" id="nav-evaluation">Control Evaluation</button>
                </li>
                <li>
                    <button onclick="navTo('review')" class="nav-item w-full text-left px-4 py-3 rounded-lg" id="nav-review">Migration & Review</button>
                </li>
            </ul>
        </nav>
    </aside>

    <!-- Main Content -->
    <div class="flex-1 overflow-y-auto w-full md:ml-0">
        <header class="sticky top-0 z-10 bg-white/90 backdrop-blur-sm border-b border-border p-4 md:p-6 shadow-sm">
            <h2 class="text-2xl font-ui text-primary">Integrated Risk Assessment Workbench</h2>
            <p class="mt-1 text-textMuted max-w-4xl text-sm font-data">
                ISO 31000-aligned approach focused on control effectiveness and risk migration.
            </p>
        </header>

        <main class="relative w-full p-4 md:p-6" id="main-scroll">
            <div class="max-w-7xl mx-auto">
                
                <!-- SECTION 1: CONTEXT -->
                <section id="context" class="content-section">
                    <h3 class="text-xl font-ui text-primary mb-5 pb-2 border-b border-border">1. Context Establishment (Scope & Criteria)</h3>
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <div class="lg:col-span-2 interactive-card p-6">
                            <h4 class="font-ui text-lg mb-3 text-text flex items-center gap-2">Organizational Scope</h4>
                            <p class="text-sm text-textMuted mb-4 font-data">Define the boundaries and critical functions under assessment.</p>
                            
                            <label class="block text-sm font-ui text-textMuted mb-1">Assessment Name</label>
                            <input type="text" id="assessment-name" value="PSCP Q3 Risk Review" class="mb-4">
                            
                            <label class="block text-sm font-ui text-textMuted mb-1">Critical Function Assessed</label>
                            <textarea id="assessment-scope" rows="3" class="w-full">Emergency Response and Public Notification Services, including IT Infrastructure and Key Personnel availability.</textarea>

                            <button onclick="navTo('assessment')" class="mt-6 btn-primary px-5 py-2.5 rounded-lg hover:bg-blue-700 transition">
                                Begin Assessment →
                            </button>
                        </div>

                        <div class="interactive-card p-5">
                            <h4 class="font-ui text-lg mb-3 text-text flex items-center gap-2">Risk Evaluation Criteria (5x5)</h4>
                            <p class="text-sm text-textMuted mb-3 font-data">Inherent Risk Score = Likelihood × Impact. Max: 25.</p>
                            
                            <div class="grid grid-cols-6 gap-px text-center text-xs font-ui border border-border bg-gray-50 rounded">
                                <div class="col-span-1 bg-white text-primary p-1 border-r">L/I</div>
                                <div class="col-span-1 bg-white text-primary p-1">1</div>
                                <div class="col-span-1 bg-white text-primary p-1">2</div>
                                <div class="col-span-1 bg-white text-primary p-1">3</div>
                                <div class="col-span-1 bg-white text-primary p-1">4</div>
                                <div class="col-span-1 bg-white text-primary p-1">5</div>

                                <div class="col-span-1 bg-white text-textMuted p-1 border-r">5</div>
                                <div class="col-span-5 grid grid-cols-5">
                                    <div class="p-1 risk-medium">5</div>
                                    <div class="p-1 risk-high">10</div>
                                    <div class="p-1 risk-high">15</div>
                                    <div class="p-1 risk-high">20</div>
                                    <div class="p-1 risk-high">25</div>
                                </div>

                                <div class="col-span-1 bg-white text-textMuted p-1 border-r">3</div>
                                <div class="col-span-5 grid grid-cols-5">
                                    <div class="p-1 risk-low">3</div>
                                    <div class="p-1 risk-medium">6</div>
                                    <div class="p-1 risk-medium">9</div>
                                    <div class="p-1 risk-high">12</div>
                                    <div class="p-1 risk-high">15</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- SECTION 2 & 3: ASSESSMENT -->
                <section id="assessment" class="content-section hidden">
                    <h3 class="text-xl font-ui text-primary mb-5 pb-2 border-b border-border">2. Assessment & 3. Control Evaluation</h3>
                    <p class="text-textMuted mb-5 text-sm font-data">
                        Evaluate <strong>Inherent Risk</strong> (before controls) and then rate control effectiveness to calculate <strong>Residual Risk</strong>.
                    </p>

                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-5 mb-6">
                        <div class="interactive-card p-4">
                            <p class="text-xs uppercase text-textMuted font-ui flex items-center gap-1">High Inherent Risks</p>
                            <p id="high-risk-count" class="text-3xl font-ui text-red-600 mt-1">0</p>
                        </div>
                        <div class="interactive-card p-4">
                            <p class="text-xs uppercase text-textMuted font-ui flex items-center gap-1">Avg. Control Effectiveness</p>
                            <p id="avg-control-eff" class="text-3xl font-ui text-primary mt-1">0 / 5.0</p>
                        </div>
                        <div class="interactive-card p-4">
                            <p class="text-xs uppercase text-textMuted font-ui flex items-center gap-1">Risks Migrated to Low</p>
                            <p id="migrated-risk-count" class="text-3xl font-ui text-green-600 mt-1">0</p>
                        </div>
                    </div>
                    
                    <div class="interactive-card p-5 mb-5 overflow-x-auto">
                        <table id="risk-table" class="min-w-full font-data text-sm">
                            <thead class="bg-gray-50 text-xs uppercase text-textMuted sticky top-0">
                                <tr>
                                    <th class="px-3 py-2 text-left">Hazard/Threat</th>
                                    <th class="px-3 py-2 w-16">L</th>
                                    <th class="px-3 py-2 w-16">I</th>
                                    <th class="px-3 py-2 text-center w-16">Inherent</th>
                                    <th class="px-3 py-2">Controls</th>
                                    <th class="px-3 py-2 text-center w-20">Eff</th>
                                    <th class="px-3 py-2 text-center w-16">Residual</th>
                                    <th class="px-3 py-2 text-center">Action</th>
                                </tr>
                            </thead>
                            <tbody id="risk-body" class="divide-y divide-gray-100">
                            </tbody>
                        </table>
                    </div>

                    <div class="interactive-card p-4">
                        <div class="flex flex-col sm:flex-row gap-3 items-center">
                            <input type="text" id="new-hazard" placeholder="Enter new hazard (e.g., Data Breach)" class="flex-1">
                            <button onclick="addRisk()" class="btn-primary w-full sm:w-auto px-4 py-2 rounded-lg text-sm">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="inline mr-1">
                                    <path d="M5 12h14"/><path d="M12 5v14"/></svg>
                                Add Risk
                            </button>
                        </div>
                    </div>
                    <button onclick="navTo('review')" class="mt-5 btn-warning px-5 py-2.5 rounded-lg float-right">
                        Review Migration →
                    </button>
                    <div class="clearfix"></div>
                </section>

                <!-- SECTION 4: REVIEW -->
                <section id="review" class="content-section hidden">
                    <h3 class="text-xl font-ui text-primary mb-5 pb-2 border-b border-border">4. Risk Migration & Review</h3>
                    <p class="text-textMuted mb-5 text-sm font-data">
                        Review migration from Inherent to Residual risk (Top 5). Large gaps = effective controls.
                    </p>

                    <div class="chart-container interactive-card p-4 mb-6">
                        <canvas id="migrationChart"></canvas>
                    </div>

                    <div class="interactive-card p-5">
                        <h4 class="font-ui text-lg mb-2 text-primary flex items-center gap-2">Recommendations</h4>
                        <p class="text-sm text-textMuted mb-3 font-data">
                            Focus on risks where <strong>Residual Risk Score</strong> remains above 9. Develop detailed <strong>Treatment Plans</strong> for these.
                        </p>
                        <button onclick="window.migrationChartInstance.update()" class="bg-gray-100 text-text px-3 py-1.5 rounded text-sm hover:bg-gray-200 font-ui">
                            Refresh Chart
                        </button>
                    </div>
                </section>
            </div>
        </main>
    </div>

    <!-- JavaScript Logic -->
    <script>
        let risks = [
            { id: 1, hazard: 'Major Cyber Attack (Ransomware)', likelihood: 4, impact: 5, controls: 'Antivirus, Backup/Recovery Plan, Staff Training', effectiveness: 2 },
            { id: 2, hazard: 'Prolonged Power Failure (24hr+)', likelihood: 3, impact: 4, controls: 'UPS system for servers, Diesel Generator (12 hr capacity)', effectiveness: 4 },
            { id: 3, hazard: 'Key Personnel Absence (Mass Sickness)', likelihood: 3, impact: 3, controls: 'Cross-training, succession planning', effectiveness: 3 }
        ];
        let nextRiskId = 4;
        let migrationChartInstance;
        
        function getRiskLevelClass(score) {
            if (score > 12) return 'risk-high';
            if (score > 6) return 'risk-medium';
            if (score > 1) return 'risk-low';
            return 'risk-vlow';
        }

        function calculateScore(likelihood, impact, effectiveness, type = 'inherent') {
            const inherent = likelihood * impact;
            if (type === 'inherent') return inherent;
            const reductionFactor = (effectiveness - 1) / 5;
            const residual = inherent * (1 - reductionFactor);
            return Math.round(residual);
        }

        function getDropdown(id, currentValue) {
            let html = `<select data-risk-id="${id}" class="text-xs border border-border rounded px-1 py-0.5 bg-white" onchange="updateRisk(${id})">`;
            for (let i = 1; i <= 5; i++) {
                html += `<option value="${i}" ${i === currentValue ? 'selected' : ''}>${i}</option>`;
            }
            html += `</select>`;
            return html;
        }

        function renderRiskTable() {
            const tbody = document.getElementById('risk-body');
            tbody.innerHTML = '';
            
            let highInherent = 0, migratedLow = 0, totalEff = 0;

            risks.forEach(risk => {
                const inherent = calculateScore(risk.likelihood, risk.impact, 0, 'inherent');
                const residual = calculateScore(risk.likelihood, risk.impact, risk.effectiveness, 'residual');
                
                if (inherent > 12) highInherent++;
                if (residual < 6) migratedLow++;
                totalEff += risk.effectiveness;

                const tr = document.createElement('tr');
                tr.className = 'hover:bg-gray-50';
                tr.setAttribute('data-risk-row-id', risk.id);

                tr.innerHTML = `
                    <td class="px-3 py-2 font-data">${risk.hazard}</td>
                    <td class="px-3 py-2">${getDropdown(risk.id, risk.likelihood)}</td>
                    <td class="px-3 py-2">${getDropdown(risk.id, risk.impact)}</td>
                    <td class="px-3 py-2 text-center"><span class="${getRiskLevelClass(inherent)}">${inherent}</span></td>
                    <td class="px-3 py-2">
                        <textarea data-risk-id="${risk.id}" class="w-full h-10 text-xs border border-border rounded p-1 font-data" onchange="updateRisk(${risk.id}, 'controls')">${risk.controls}</textarea>
                    </td>
                    <td class="px-3 py-2 text-center">
                        ${getDropdown(risk.id, risk.effectiveness)}
                    </td>
                    <td class="px-3 py-2 text-center"><span class="${getRiskLevelClass(residual)}">${residual}</span></td>
                    <td class="px-3 py-2 text-center">
                        <button onclick="deleteRisk(${risk.id})" class="text-red-500 hover:text-red-700">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></svg>
                        </button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
            
            document.getElementById('high-risk-count').innerText = highInherent;
            document.getElementById('migrated-risk-count').innerText = migratedLow;
            const avg = risks.length ? (totalEff / risks.length).toFixed(1) : 0;
            document.getElementById('avg-control-eff').innerText = `${avg} / 5.0`;

            updateMigrationChart();
        }

        function updateRisk(id, field = null) {
            const idx = risks.findIndex(r => r.id === id);
            if (idx === -1) return;
            const tr = document.querySelector(`[data-risk-row-id="${id}"]`);
            if (!tr) return;
            
            if (field === 'controls') {
                risks[idx].controls = tr.querySelector('textarea').value;
            } else {
                const selects = tr.querySelectorAll('select');
                risks[idx].likelihood = parseInt(selects[0].value);
                risks[idx].impact = parseInt(selects[1].value);
                risks[idx].effectiveness = parseInt(selects[2].value);
            }
            renderRiskTable(); 
        }

        function addRisk() {
            const name = document.getElementById('new-hazard').value.trim();
            if (name) {
                risks.push({ id: nextRiskId++, hazard: name, likelihood: 3, impact: 3, controls: 'TBD', effectiveness: 1 });
                document.getElementById('new-hazard').value = '';
                renderRiskTable();
            }
        }

        function deleteRisk(id) {
            risks = risks.filter(r => r.id !== id);
            renderRiskTable();
        }

        function updateMigrationChart() {
            const sorted = [...risks].sort((a, b) => {
                return calculateScore(b.likelihood, b.impact, 0, 'inherent') - calculateScore(a.likelihood, a.impact, 0, 'inherent');
            }).slice(0, 5);

            const labels = sorted.map(r => r.hazard.split('(')[0].trim());
            const inherent = sorted.map(r => calculateScore(r.likelihood, r.impact, 0, 'inherent'));
            const residual = sorted.map(r => calculateScore(r.likelihood, r.impact, r.effectiveness, 'residual'));

            const ctx = document.getElementById('migrationChart').getContext('2d');
            if (migrationChartInstance) {
                migrationChartInstance.data.labels = labels;
                migrationChartInstance.data.datasets[0].data = inherent;
                migrationChartInstance.data.datasets[1].data = residual;
                migrationChartInstance.update();
                return;
            }

            migrationChartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Inherent Risk',
                            data: inherent,
                            backgroundColor: 'rgba(239, 68, 68, 0.6)',
                            borderColor: '#ef4444',
                            borderWidth: 1,
                            borderRadius: 4
                        },
                        {
                            label: 'Residual Risk',
                            data: residual,
                            backgroundColor: 'rgba(0, 120, 255, 0.7)',
                            borderColor: '#0078ff',
                            borderWidth: 1,
                            borderRadius: 4
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { labels: { font: { family: 'Poppins' } } },
                        tooltip: { bodyFont: { family: 'Poppins' }, titleFont: { family: 'Montserrat', weight: 'bold' } }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 25,
                            grid: { color: '#edf2f7' },
                            ticks: { font: { family: 'Poppins' } }
                        },
                        x: {
                            grid: { color: '#edf2f7' },
                            ticks: { font: { family: 'Poppins' } }
                        }
                    }
                }
            });
            window.migrationChartInstance = migrationChartInstance;
        }

        function navTo(sectionId) {
            document.querySelectorAll('.content-section').forEach(el => el.classList.add('hidden'));
            const target = document.getElementById(sectionId);
            if (target) target.classList.remove('hidden');
            document.getElementById('main-scroll').scrollTop = 0;

            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            const activeBtn = Array.from(document.querySelectorAll('.nav-item')).find(btn => 
                btn.getAttribute('onclick')?.includes(`'${sectionId}'`)
            );
            if (activeBtn) activeBtn.classList.add('active');

            if (sectionId === 'review') {
                updateMigrationChart();
                if (migrationChartInstance) migrationChartInstance.resize();
            }

            if (window.innerWidth < 768) toggleMobileMenu();
        }

        function toggleMobileMenu() {
            const sidebar = document.getElementById('sidebar');
            const backdrop = document.getElementById('backdrop');
            const isHidden = sidebar.classList.contains('-translate-x-full');
            sidebar.classList.toggle('-translate-x-full', !isHidden);
            backdrop.classList.toggle('active', !isHidden);
        }

        document.getElementById('mobile-menu-btn').addEventListener('click', toggleMobileMenu);

        window.onload = () => {
            renderRiskTable();
            navTo('context');
        };
    </script>
</body>
</html>
